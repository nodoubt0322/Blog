<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>玩轉npm script | 學習隨記</title>
    <meta name="description" content="npm run實際上就是npm run-script的alias，當你執行npm run，他會列出package.json檔案在scripts裡面的所有指令。npm run test會執行scripts裡面的test指令，因為test是npm run-script內建的指令之一，所以可以縮寫成npm test，甚至是npm t(npm test的alias)，不是內建指令就必須把run乖乖的打出來，像npm run echo...">
    <link rel="stylesheet" href="/blog/assets/style.a1c5f9ba.css">
    <link rel="modulepreload" href="/blog/assets/Home.7b776c27.js">
    <link rel="modulepreload" href="/blog/assets/app.d8d1bef2.js">
    <link rel="modulepreload" href="/blog/assets/posts_2022-04-22_玩轉npm_script.md.be2321c1.lean.js">
    
    <link rel="icon" href="/blog/favicon.ico">
  <meta name="twitter:title" content="玩轉npm script | 學習隨記">
  <meta property="og:title" content="玩轉npm script | 學習隨記">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><div class="theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/blog/" aria-label="學習隨記, back to home" data-v-40587210 data-v-7ac13a1e><!----> 學習隨記</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/blog/" data-v-49fe041d>Home <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/blog/pages/archives" data-v-49fe041d>Archives <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/blog/pages/tags" data-v-49fe041d>Tags <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/blog/pages/about" data-v-49fe041d>About <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/blog/" data-v-49fe041d>Home <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/blog/pages/archives" data-v-49fe041d>Archives <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/blog/pages/tags" data-v-49fe041d>Tags <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/blog/pages/about" data-v-49fe041d>About <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-17c48e2f><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#npm-run-script">npm run-script</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#內建指令">內建指令</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#inject-環境變量">inject 環境變量</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#bin-執行檔">.bin 執行檔</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#npm-run-script-的串行跟併行">npm run-script 的串行跟併行</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#串行">串行</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#併行">併行</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#pre-post-scripts">pre &amp; post scripts</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#跨平台的-npm-run-script-處理">跨平台的 npm run-script 處理</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#原生寫法">原生寫法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#套件寫法">套件寫法</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h1 id="玩轉-npm-script" tabindex="-1">玩轉 npm script <a class="header-anchor" href="#玩轉-npm-script" aria-hidden="true">#</a></h1><h2 id="npm-run-script" tabindex="-1">npm run-script <a class="header-anchor" href="#npm-run-script" aria-hidden="true">#</a></h2><h3 id="內建指令" tabindex="-1">內建指令 <a class="header-anchor" href="#內建指令" aria-hidden="true">#</a></h3><p>npm run 實際上就是<code>npm run-script</code>的 alias，當你執行 npm run，他會列出<code>package.json</code>檔案在<code>scripts</code>裡面的所有指令。</p><p>npm run test 會執行 scripts 裡面的<code>test</code>指令，因為 test 是<code>npm run-script</code>內建的<a href="https://docs.npmjs.com/cli/v8/commands/npm-run-script" target="_blank" rel="noopener noreferrer">指令之一</a>，所以可以縮寫成<code>npm test</code>，甚至是<code>npm t</code>(npm test 的 alias)，不是內建指令就必須把 run 乖乖的打出來，像<code>npm run echo</code>。</p><p>package.json</p><div class="language-json"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;echo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo $PATH&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="inject-環境變量" tabindex="-1">inject 環境變量 <a class="header-anchor" href="#inject-環境變量" aria-hidden="true">#</a></h3><p>在 terminal 輸入<code>echo $PATH &amp; npm run echo</code>，他會印出 PATH 的環境變量跟在 npm run-script 裡面的環境變量，如圖</p><p><img src="/blog/assets/01.f1cb5233.png" alt="環境變量"></p><p>你會發現多了好幾個 xxx/xxx/node_modules/.bin 的東西，這些環境變量就是在執行 npm run-script 的時候加上去的，執行完之後又移除。</p><p>他的規則，就是當下的目錄找不到該 modules 的 bin 就往<code>上一層目錄</code>找，直到<code>根目錄</code>，就也是 nodejs 引用 modules 的規則底層機制。</p><h3 id="bin-執行檔" tabindex="-1">.bin 執行檔 <a class="header-anchor" href="#bin-執行檔" aria-hidden="true">#</a></h3><p>輸入<code>npm i eslint</code>安裝 eslint，安裝完之後，會發現在<code>./node_modules/.bin</code>多了幾個檔案，用<code>ls -alh</code>去看一下他的狀態，發現 eslint 他是一個<code>link</code>，指向<code>./node_modules/eslint/bin/eslint.js</code>的檔案。</p><p>安裝 package 的時候，會在/node_modules/.bin 裡面生成相對應的 link，該 link 會指向該 package 的<code>入口js檔案</code>，然後在執行 npm run-script 的時候，因為 inject 了.bin 的環境變量，所以可以在 npm run-script 裡面直接使用該 package。</p><p>使用 <code>bunx或是npx</code> &lt;包名稱&gt;，會先找./node_modules/.bin 裡面的檔案，可以透過這樣的方式去執行專案裡面安裝的套件</p><p><img src="/blog/assets/02.f696e17c.jpg" alt="link"></p><div class="language-json"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;echo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo $PATH&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="npm-run-script-的串行跟併行" tabindex="-1">npm run-script 的串行跟併行 <a class="header-anchor" href="#npm-run-script-的串行跟併行" aria-hidden="true">#</a></h2><ul><li>串行：一個執行完，換下一個執行，符號是<code>&amp;&amp;</code></li><li>並行：所有只有一起同時執行，符號是<code>&amp;</code></li></ul><h3 id="串行" tabindex="-1">串行 <a class="header-anchor" href="#串行" aria-hidden="true">#</a></h3><p>有個 scripts 設定如下</p><div class="language-json"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lint:js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint *.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint:css&quot;</span><span class="token operator">:</span> <span class="token string">&quot;stylelint *.less&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint:json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jsonlint --quiet *.json&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint:js &amp;&amp; npm run lint:css &amp;&amp; npm run lint:json&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><br><p>我們使用<code>&amp;&amp;</code>，把 npm run-script 串連起來，一個接著一個執行，就是<code>lint:js</code>執行完了換到<code>lint:css</code>執行，然後<code>lint:json</code></p><h3 id="併行" tabindex="-1">併行 <a class="header-anchor" href="#併行" aria-hidden="true">#</a></h3><p>併行就是同時執行，只要把<code>&amp;&amp;</code>換成<code>&amp;</code>就可以了，但是因為併行他是使用<code>子進程(subprocess)</code>來執行 npm run-script，假如沒下<code>wait</code>指令，<code>主進程</code>不會等所有<code>子進程全執行完</code>，後面沒指令他就 exit 跳出了，然後 watch 的<code>子進程也會被中斷</code>，設定如下。</p><div class="language-json"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lint:js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint *.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint:css&quot;</span><span class="token operator">:</span> <span class="token string">&quot;stylelint *.less&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint:json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jsonlint --quiet *.json&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --watchAll&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint:js &amp; npm run lint:css &amp; npm run lint:json &amp; npm run jest &amp; wait&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>也可以使用<code>npm-run-all</code>package，讓代碼看起來更簡潔一點，加上<code>--parallel</code>代表是<code>併行</code>，沒加就是串行。</p><div class="language-bash"><pre><code><span class="token function">npm</span> i npm-run-all -D
</code></pre></div><div class="language-json"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lint:js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint *.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint:css&quot;</span><span class="token operator">:</span> <span class="token string">&quot;stylelint *.less&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lint:json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jsonlint --quiet *.json&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --watchAll&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm-run-all --parallel lint:* jest &amp; wait&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="pre-post-scripts" tabindex="-1">pre &amp; post scripts <a class="header-anchor" href="#pre-post-scripts" aria-hidden="true">#</a></h2><p>這是讓你在執行某個 npm run-script<code>之前</code>跟<code>之後</code>，觸發 scripts，只要在該 script 的前面加上<code>pre</code>或是<code>post</code>就可以了，如下：</p><div class="language-json"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;preecho&quot;</span><span class="token operator">:</span><span class="token string">&quot;echo a&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;echo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo $PATH&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;postecho&quot;</span><span class="token operator">:</span><span class="token string">&quot;echo b&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-bash"><pre><code><span class="token function">npm</span> run <span class="token builtin class-name">echo</span>
<span class="token comment"># 會先印出a, 在印出環境變量PATH, 在印出b</span>
</code></pre></div><h2 id="跨平台的-npm-run-script-處理" tabindex="-1">跨平台的 npm run-script 處理 <a class="header-anchor" href="#跨平台的-npm-run-script-處理" aria-hidden="true">#</a></h2><h3 id="原生寫法" tabindex="-1">原生寫法 <a class="header-anchor" href="#原生寫法" aria-hidden="true">#</a></h3><p>linux-like 系統跟 windows 執行指令不一樣，所以不是<code>分別寫兩種 scripts</code>，針對 linux-like 系統跟 windows，就是透過套件幫你處理。如下面範例，設定環境變量除了要多個<code>set</code>之外，還要加上<code>&amp;&amp;</code>去連結指令，而且<code>不能有空白</code></p><div class="language-json"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span><span class="token string">&quot;BASE=dev node index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;win-dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;set BASE=dev&amp;&amp;node index.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="套件寫法" tabindex="-1">套件寫法 <a class="header-anchor" href="#套件寫法" aria-hidden="true">#</a></h3><p>安裝 cross-env 套件，然後在 scripts 前面加上 cross-env，他就會幫你處理 windows 平台設定環境變量的問題了。話說 cross-env 這套件是 kentcdodds 做的，2020 年底他就宣布不在維護了，github 上寫了兩個推薦的套件，結果比他這個還舊還不 active 是...xd</p><div class="language-bach"><pre><code>npm i cross-env
</code></pre></div><div class="language-json"><pre><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span><span class="token string">&quot;cross-env  BASE=dev node index.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>其他類似的東西做個統整，如下：</p><ul><li>cross-env：設定環境變量</li><li>rimraf：刪除檔案</li><li>cpr：複製檔案</li><li>make-dir-cli：建立資料夾</li></ul><p>這些東西底層原理核心都是，用<code>process.arch</code>去判斷作業系統，<code>parse參數</code>，然後用<code>process.spawn</code>去執行命令</p><!----></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><!----></div></div><div class="updated" data-v-5c96fb00><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--><div class="site-footer"> MIT Licensed | Copyright © 2022 <a class="vitepress">nodoubt0322</a><br> Powered by <a class="vitepress" target="_blank" href="//vitepress.vuejs.org/">VitePress</a></div><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"b195c0fc\",\"pages_about.md\":\"be89e82b\",\"pages_archives.md\":\"235a9f6a\",\"pages_tags.md\":\"ae55c886\",\"posts_2022-04-18_我的職業是股東讀後感.md\":\"0e574acc\",\"posts_2022-04-22_玩轉npm_script.md\":\"be2321c1\",\"posts_2022-05-12_async_await中的迴圈.md\":\"f51c9890\",\"posts_2024-01-29_邏輯運算符的差別.md\":\"d95e1644\"}")</script>
    <script type="module" async src="/blog/assets/app.d8d1bef2.js"></script>
    
  </body>
</html>